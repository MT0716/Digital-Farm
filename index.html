<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿å…¬çš„èœåœ’è§€å¯Ÿè¨˜ï¼ˆæœ‰åœ–ï¼‰</title>
    <style>
        :root {
            /* é˜¿å…¬èœåœ’è‰²ç¥¨ */
            --primary: #558B2F;   /* æ·±ç¶ è‰² */
            --secondary: #8BC34A; /* æ·ºç¶ è‰² */
            --accent: #FF7043;    /* æš–æ©˜è‰² */
            --bg: #FFF8E1;        /* ç±³é»ƒç´™å¼µè‰² */
            --text: #5D4037;      /* æ·±è¤è‰²æ–‡å­— */
            --card-bg: #ffffff;
            --border: #D7CCC8;    /* æ·ºè¤é‚Šæ¡† */
            --info-bg: #E3F2FD;   /* ç§‘æ™®è— */
            --info-text: #0D47A1; /* ç§‘æ™®æ·±è— */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            /* æ–¹æ ¼ç´™èƒŒæ™¯ */
            background-image: 
                linear-gradient(#E0E0E0 1px, transparent 1px),
                linear-gradient(90deg, #E0E0E0 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: var(--text);
        }

        .container {
            background: var(--card-bg);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(93, 64, 55, 0.15);
            text-align: center;
            position: relative;
            border: 2px solid var(--border);
            overflow: hidden;
        }

        /* --- æ¨™é¡Œèˆ‡æ–‡å­— --- */
        h1 { color: var(--primary); margin-bottom: 5px; font-weight: 900; letter-spacing: 1px; }
        h2 { color: var(--primary); border-bottom: 2px dashed var(--secondary); padding-bottom: 10px; margin-top: 0; }
        .subtitle { color: #8D6E63; font-size: 14px; margin-bottom: 20px; }
        label { display: block; margin-top: 20px; margin-bottom: 8px; font-weight: bold; text-align: left; color: var(--text); }

        /* --- åœ–ç‰‡å±•ç¤ºå€å¡Š --- */
        .image-area {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px; /* åœ–ç‰‡é–“è· */
            margin-bottom: 15px;
            min-height: 150px;
        }

        .real-photo {
            object-fit: cover;
            border-radius: 8px;
            border: 4px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }

        /* å–®å¼µåœ–ç‰‡æ¨£å¼ */
        .single-img {
            width: 100%;
            height: 220px;
            transform: rotate(-1deg);
        }

        /* é›™å¼µåœ–ç‰‡å°æ¯”æ¨£å¼ */
        .double-img {
            width: 48%; /* å…©å¼µä¸¦æ’ */
            height: 160px;
        }
        .double-img:first-child { transform: rotate(-2deg); }
        .double-img:last-child { transform: rotate(2deg); }

        .real-photo:hover { transform: scale(1.05) rotate(0deg); z-index: 5; }

        /* --- æ•…äº‹æ¡† --- */
        .story-box {
            background: #FFF3E0;
            border-left: 5px solid var(--accent);
            padding: 15px;
            text-align: left;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 15px;
            line-height: 1.6;
        }

        /* --- ç§‘æ™®çŸ¥è­˜æ¡† --- */
        details {
            margin-top: 15px;
            background: var(--info-bg);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #BBDEFB;
            text-align: left;
        }
        
        summary {
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            color: var(--info-text);
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        summary::after { content: '+'; font-size: 18px; font-weight: bold; }
        details[open] summary::after { content: '-'; }

        .knowledge-content {
            padding: 15px;
            border-top: 1px solid #BBDEFB;
            font-size: 14px;
            color: #333;
            line-height: 1.8;
            background: #fff;
            white-space: pre-line; 
            word-wrap: break-word;
        }

        /* --- è¼¸å…¥å…ƒä»¶æ¨£å¼ --- */
        input[type="text"] {
            width: 100%; padding: 12px; border: 2px solid var(--border);
            border-radius: 10px; font-size: 16px; background: #FAFAFA;
            color: var(--text); text-align: center; outline: none; transition: border 0.3s;
        }
        input[type="text"]:focus { border-color: var(--primary); background: #fff; }

        input[type="range"] {
            width: 100%; margin: 10px 0; background: transparent;
            -webkit-appearance: none; appearance: none; cursor: pointer;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%; height: 10px; background: #EFEBE9;
            border-radius: 5px; border: 1px solid #D7CCC8;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            height: 24px; width: 24px; background: var(--primary);
            margin-top: -8px; border-radius: 50%; border: 3px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .checkbox-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .checkbox-group label {
            background: #FAFAFA; padding: 10px; border: 1px solid var(--border);
            cursor: pointer; font-size: 14px; margin: 0; border-radius: 8px;
            flex: 1 0 40%; text-align: center; color: #888; transition: 0.2s;
        }
        input[type="checkbox"] { display: none; }
        input[type="checkbox"]:checked + span { color: var(--primary); font-weight: bold; }
        .checkbox-group label:has(input:checked) {
            border-color: var(--primary); background: #F1F8E9;
            box-shadow: 0 2px 5px rgba(85, 139, 47, 0.1);
        }

        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 35px;
            font-size: 18px; border-radius: 50px; cursor: pointer; transition: 0.2s;
            font-weight: bold; box-shadow: 0 4px 0 #33691E; width: 100%; margin-top: 20px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 0 #33691E; background: #689F38; }
        .btn:active { transform: translateY(2px); box-shadow: 0 0 0 #33691E; }
        
        .option-btn {
            display: flex; align-items: center; width: 100%; margin: 12px 0; padding: 15px;
            font-size: 16px; background: #fff; border: 2px solid #E0E0E0; color: var(--text);
            border-radius: 12px; cursor: pointer; text-align: left; transition: 0.2s;
            box-sizing: border-box;
        }
        .option-btn:hover { background: #F1F8E9; border-color: var(--primary); transform: translateX(5px); }

        .camera-box {
            width: 100%; height: 220px; border: 3px dashed var(--border); background: #FAFAFA;
            display: flex; justify-content: center; align-items: center;
            border-radius: 10px; cursor: pointer; position: relative; overflow: hidden;
            transition: border-color 0.3s;
        }
        .camera-box:hover { border-color: var(--primary); background: #F9FBE7; }
        .camera-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .camera-placeholder { text-align: center; color: #8D6E63; }
        .camera-icon { font-size: 40px; display: block; margin-bottom: 5px; }
        #cameraInput { display: none; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- çµæœèˆ‡æ—¥è¨˜ --- */
        .id-card, .diary-card {
            border: 4px double var(--primary); padding: 20px; background: #fff;
            margin-top: 20px; position: relative; text-align: left; border-radius: 10px;
        }
        .id-card { text-align: center; }
        
        .diary-header {
            border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        .diary-date { font-size: 12px; color: #888; }
        .diary-title { font-size: 22px; font-weight: bold; color: var(--text); }
        
        .stat-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; color: #555; }
        .stat-bar-bg { width: 60%; height: 10px; background: #EFEBE9; border-radius: 5px; overflow: hidden; }
        .stat-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 1s; border-radius: 5px; }
        
        .diary-photo {
            width: 100%; height: 180px; border: 1px solid #eee; margin-bottom: 15px;
            background: #f9f9f9; display: flex; justify-content: center; align-items: center; color: #ccc;
            overflow: hidden; border-radius: 5px;
        }
        .diary-photo img { width: 100%; height: 100%; object-fit: cover; }

        .stamp {
            position: absolute; bottom: 20px; right: 20px; transform: rotate(-15deg);
            border: 3px solid #D32F2F; color: #D32F2F; padding: 5px 10px;
            font-weight: bold; font-size: 20px; opacity: 0; animation: stampIn 0.5s 1s forwards;
        }
        @keyframes stampIn { from { opacity: 0; transform: scale(2) rotate(-15deg); } to { opacity: 0.7; transform: scale(1) rotate(-15deg); } }

        .feedback-modal {
            background: rgba(255, 255, 255, 0.98); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border-radius: 15px; z-index: 10; padding: 20px; box-sizing: border-box; text-align: center;
            overflow-y: auto;
        }
        .feedback-content { width: 100%; max-height: 90vh; }
    </style>
</head>
<body>

<div class="container fade-in" id="main-container">
    
    <div id="start-screen">
        <h1>é˜¿å…¬çš„èœåœ’è§€å¯Ÿè¨˜</h1>
        <div class="subtitle">è‡ªç„¶è¾²æ³•ç¹¼æ‰¿è€…è€ƒé©—</div>
        <div class="story-box">
            <p><strong>å‰æƒ…æè¦ï¼š</strong><br>
            æš‘å‡åˆ°äº†ï¼Œé˜¿å…¬è…°é–ƒåˆ°äº†ä¸èƒ½ä¸‹ç”°ã€‚<br>
            é˜¿å…¬èªªï¼šã€Œä¹–å­«æ¬¸ï¼Œé€™ç‰‡ç”°äº¤çµ¦ä½ äº†ã€‚è¨˜ä½ï¼Œ<b>åœŸåœ°æ˜¯æœ‰ç”Ÿå‘½çš„ï¼Œä¸è¦ç”¨æ¯’è—¥å‚·å®³å®ƒã€‚</b>ã€<br>
            é€šéé˜¿å…¬çš„è§€å¿µè€ƒè©¦ï¼Œæ‰èƒ½é †åˆ©å¹«å¿™ç…§é¡§ä½œç‰©ï¼</p>
        </div>
        <label>è«‹åœ¨æ—¥è¨˜æœ¬å¯«ä¸‹ä½ çš„åå­—ï¼š</label>
        <input type="text" id="username" maxlength="10">
        <button class="btn" onclick="startGame()">æˆ´ä¸Šè‰å¸½ï¼Œé–‹å§‹æŒ‘æˆ°ï¼</button>
    </div>

    <div id="game-screen" class="hidden">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:14px; color:#888;">
            <span id="day-counter">Day 1</span>
            <span>é˜¿å…¬çš„è€ƒé©—</span>
        </div>
        <div style="width:100%; height:8px; background:#E0E0E0; border-radius:10px; margin-bottom:20px;">
            <div id="progress" style="height:100%; background:var(--primary); width:0%; transition:0.4s; border-radius:10px;"></div>
        </div>
        
        <h2 id="q-title" style="border:none; margin: 5px 0;">äº‹ä»¶æ¨™é¡Œ</h2>
        
        <div id="image-area" class="image-area"></div>
        
        <div class="story-box">
            <p id="q-desc" style="margin:0;">é€™è£¡æœƒé¡¯ç¤ºåŠ‡æƒ…æè¿°...</p>
        </div>
        <div id="options-area"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h1 style="color: var(--accent);">ğŸŠ è©¦ç…‰é€šéï¼</h1>
        <p>ä½ å·²ç¶“å…·å‚™äº†è‡ªç„¶è¾²æ³•çš„çŸ¥è­˜ã€‚<br>é˜¿å…¬æŠŠä»–çš„ç›¸æ©Ÿå’Œè§€å¯Ÿæ—¥è¨˜æœ¬äº¤çµ¦äº†ä½ ã€‚</p>
        
        <div class="id-card fade-in">
            <div style="font-size: 50px;">ğŸ“œ</div>
            <h2 style="margin: 10px 0; color:var(--text); border:none;">åˆæ ¼è¾²å¤«è­‰æ›¸</h2>
            <p>èŒ²è­‰æ˜ <strong id="result-name" style="color:var(--primary); font-size: 20px;"></strong></p>
            <p>æˆåŠŸå®ˆè­·äº†åœŸåœ°ï¼Œç²å¾—é€²å…¥èœåœ’çš„è³‡æ ¼ã€‚</p>
            <div class="stamp">åˆæ ¼</div>
        </div>
        
        <button class="btn" style="background: var(--accent); margin-top:20px;" onclick="goToScanner()">ğŸ“· å‰å¾€ç´€éŒ„æ¤ç‰©</button>
    </div>

    <div id="scanner-input" class="hidden">
        <h2>ğŸ“· ç”°é–“è§€å¯Ÿæ—¥è¨˜</h2>
        <p style="font-size:14px; color:#666;">è«‹è§€å¯Ÿç”°è£¡çš„ä½œç‰©ï¼Œä¸¦è¨˜éŒ„ä¸‹ä¾†ã€‚</p>

        <label>1. æ‹ä¸‹ä½œç‰©çš„æ¨£å­ï¼š</label>
        <div class="camera-box" onclick="document.getElementById('cameraInput').click()">
            <div class="camera-placeholder" id="cam-placeholder">
                <span class="camera-icon">ğŸ“·</span>
                é»æ“Šé–‹å•Ÿç›¸æ©Ÿ / ä¸Šå‚³ç…§ç‰‡
            </div>
            <img id="preview-img" src="" alt="Crop Preview">
        </div>
        <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleFileSelect(event)">

        <label>2. é€™æ˜¯ä»€éº¼ä½œç‰©ï¼Ÿ</label>
        <input type="text" id="cropName" placeholder="ä¾‹å¦‚ï¼šèµè‹£ã€åœ°ç“œè‘‰">

        <label>3. ç”Ÿé•·ç‹€æ³ (é‚„å¾ˆå° ~ é ­å¥½å£¯å£¯)ï¼š<span id="growthVal">50</span>%</label>
        <input type="range" id="growth" min="0" max="100" value="50" oninput="updateVal('growthVal', this.value)">

        <label>4. å¥åº·/æ°´åˆ† (æ¯é»ƒ ~ ç¿ ç¶ )ï¼š<span id="healthVal">50</span>%</label>
        <input type="range" id="health" min="0" max="100" value="50" oninput="updateVal('healthVal', this.value)">

        <label>5. æœ‰æ²’æœ‰ç™¼ç¾ä»€éº¼å•é¡Œï¼Ÿ(è¤‡é¸)</label>
        <div class="checkbox-group">
            <label><input type="checkbox" value="èŸ²å’¬"> <span>ğŸ› æœ‰èŸ²å’¬</span></label>
            <label><input type="checkbox" value="ç¼ºæ°´"> <span>â˜€ï¸ åœŸå¤ªä¹¾</span></label>
            <label><input type="checkbox" value="é›œè‰"> <span>ğŸŒ¿ é›œè‰å¤š</span></label>
            <label><input type="checkbox" value="ç‡Ÿé¤Šä¸è‰¯"> <span>ğŸ‚ è‘‰å­é»ƒ</span></label>
        </div>

        <button class="btn" onclick="generateDiary()">âœ¨ å®Œæˆæ—¥è¨˜</button>
    </div>

    <div id="diary-result" class="hidden">
        <h1>ğŸ“” è§€å¯Ÿç´€éŒ„å®Œæˆ</h1>
        <p>ä½ çœŸçš„å¾ˆç”¨å¿ƒåœ¨ç…§é¡§å®ƒå€‘å‘¢ï¼</p>

        <div class="diary-card fade-in">
            <div class="diary-header">
                <div class="diary-title" id="diary-crop-name">ä½œç‰©åç¨±</div>
                <div class="diary-date" id="today-date">202X/XX/XX</div>
            </div>

            <div class="diary-photo">
                <img id="final-photo" src="" alt="æœªä¸Šå‚³ç…§ç‰‡">
                <span id="no-photo-text" style="display:none;">(æœªæä¾›ç…§ç‰‡)</span>
            </div>

            <div class="stat-row">
                <span>ç”Ÿé•·é€²åº¦</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-growth"></div></div>
                <span id="txt-growth">0%</span>
            </div>
            <div class="stat-row">
                <span>å¥åº·æ°£è‰²</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-health"></div></div>
                <span id="txt-health">0%</span>
            </div>

            <hr style="border:0; border-top:1px dashed #ccc; margin:15px 0;">
            
            <div style="font-size:14px; line-height:1.6; color:#555;">
                <strong>ğŸ“‹ é˜¿å…¬çš„ç­†è¨˜ï¼š</strong><br>
                <span id="diary-report">åˆ†æä¸­...</span>
            </div>

            <div class="stamp" id="diary-rank">ç‰¹å„ª</div>
        </div>

        <button class="btn" style="background:#8D6E63; margin-top:20px;" onclick="resetScanner()">å†è§€å¯Ÿä¸‹ä¸€æ ª</button>
    </div>

</div>

<script>
    /* ================= éŠæˆ²éƒ¨åˆ†è®Šæ•¸èˆ‡é‚è¼¯ ================= */
    
    // è¨­å®šé¡Œç›®è³‡æ–™èˆ‡åœ–ç‰‡æª”å
    const storyQuestions = [
        {
            title: "é›œè‰æ‹”ä¸æ‹”ï¼Ÿ", 
            // é€™è£¡æŒ‡å®šå…©å¼µåœ–ç‰‡
            images: ["1.jpg", "2.jpg"],
            desc: "ç”°åŸ‚ä¸Šé•·æ»¿äº†ã€Œé¦™é™„å­ã€é›œè‰ã€‚ä½ æ‹¿èµ·é‹¤é ­æº–å‚™å‹•æ‰‹...",
            grandpa: "é˜¿å…¬ï¼šã€Œä¿®ä½†å¹¾å‹’ï¼å®ƒçš„æ ¹å¯ä»¥å¹«å¿™æŠ“ä½æ³¥åœŸï¼Œå¤§é›¨ä¾†æ‰ä¸æœƒæµå¤±å–”ï¼ã€",
            options: [
                { 
                    text: "è½é˜¿å…¬çš„ï¼Œåªä¿®å‰ªä¸ŠåŠéƒ¨ï¼Œä¿ç•™æ ¹ç³»æŠ“åœ°ã€‚", 
                    type: "good", 
                    feedback: "æ­£ç¢ºï¼é€™å°±æ˜¯ã€è‰ç”Ÿæ ½åŸ¹ã€ï¼Œé©åº¦é›œè‰èƒ½ä¿è­·åœŸå£¤ï¼",
                    knowledge: "ã€è‰ç”Ÿæ ½åŸ¹ã€‘(Sod Culture)\næŒ‡åœ¨æœåœ’æˆ–è¾²ç”°ä¸­ä¿ç•™é©åº¦é›œè‰ï¼Œè€Œéå°‡å…¶é™¤ç›¡ã€‚é€™äº›è‰çš„æ ¹ç³»èƒ½ç·ŠæŠ“åœŸå£¤ï¼Œé˜²æ­¢å¤§é›¨å°‡çè²´çš„è¡¨åœŸæ²–åˆ·æµå¤±ï¼ˆæ°´åœŸä¿æŒï¼‰ã€‚æ­¤å¤–ï¼Œé›œè‰è…çˆ›å¾Œæœƒè®Šæˆæœ‰æ©Ÿè³ªï¼Œå›æ­¸åœŸå£¤æˆç‚ºé¤Šåˆ†ï¼Œé‚„èƒ½æä¾›ç›ŠèŸ²æ£²æ¯åœ°ï¼Œç¶­æŒç”Ÿæ…‹å¹³è¡¡ã€‚"
                },
                { 
                    text: "çœ‹èµ·ä¾†å¤ªç…©äº†ï¼ŒæŒ–åœ°ä¸‰å°ºä¹Ÿè¦æŠŠå®ƒé™¤æ ¹ï¼", 
                    type: "bad", 
                    feedback: "å“å‘€ï¼åœŸç¿»å¤ªæ·±ç ´å£äº†çµæ§‹ï¼Œä¸‹é›¨æ³¥åœŸéƒ½æµå…‰äº†...",
                    knowledge: "ã€éåº¦è€•ä½œçš„å±å®³ã€‘\nå°‡é›œè‰é€£æ ¹æ‹”èµ·æˆ–éåº¦ç¿»åœŸï¼Œæœƒç ´å£åœŸå£¤çš„åœ˜ç²’çµæ§‹ï¼Œä½¿åœŸå£¤è®Šå¾—é¬†æ•£ã€æ˜“è¢«é›¨æ°´æ²–åˆ·ã€‚é•·æœŸä¸‹ä¾†æœƒå°è‡´åœŸå£¤è²§ç˜ ã€ä¿æ°´åŠ›ä¸‹é™ï¼Œç”šè‡³é€ æˆåš´é‡çš„åœŸçŸ³æµå¤±å•é¡Œã€‚è‡ªç„¶è¾²æ³•å¼·èª¿ã€Œå°‘è€•ã€æˆ–ã€Œå…è€•ã€ï¼Œä»¥ç¶­æŒåœŸå£¤çµæ§‹çš„å®Œæ•´æ€§ã€‚"
                }
            ]
        },
        {
            title: "ç™½è‰²è´è¶çš„é™·é˜±", 
            images: ["3.png"],
            desc: "ç”°è£¡é£›ä¾†å¥½å¤šç™½è´è¶ï¼Œå¥½æ¼‚äº®ï¼ä½†é«˜éº—èœè‘‰ä¸Šå¤šäº†å¥½å¤šç¶ è‰²æ¯›æ¯›èŸ²...",
            grandpa: "é˜¿å…¬ï¼šã€Œé€™äº›æ˜¯ç´‹ç™½è¶çš„å¹¼èŸ²ï¼Œæ­£åœ¨åƒæˆ‘å€‘çš„èœï¼ä½†æˆ‘ä¸æƒ³ç”¨æ¯’è—¥...ã€",
            options: [
                { 
                    text: "å»è²·æœ€å¼·æ•ˆçš„åŒ–å­¸æ®ºèŸ²åŠ‘ï¼Œå™´ä¸€ä¸‹æ­»å…‰å…‰ã€‚", 
                    type: "bad", 
                    feedback: "æ¯æ¹¯å–”ï¼è¾²è—¥æœƒæ®˜ç•™ï¼Œè€Œä¸”æœƒæ®ºæ­»å…¶ä»–ç›ŠèŸ²ï¼",
                    knowledge: "ã€è¾²è—¥çš„ä»£åƒ¹ã€‘\nåŒ–å­¸æ®ºèŸ²åŠ‘é›–ç„¶æ®ºèŸ²é€Ÿåº¦å¿«ï¼Œä½†æœƒç”¢ç”Ÿã€Œç”Ÿç‰©æ”¾å¤§ä½œç”¨ã€ï¼Œæ¯’ç´ æœƒåœ¨é£Ÿç‰©éˆä¸­ç´¯ç©ï¼Œæœ€å¾Œè¢«äººåƒé€²è‚šå­ã€‚æ­¤å¤–ï¼Œå»£æ•ˆæ€§æ®ºèŸ²åŠ‘æœƒä¸åˆ†æ•µæˆ‘ï¼Œé€£å¹«å¿™åƒå®³èŸ²çš„ç“¢èŸ²ã€è³è‚ï¼Œä»¥åŠå¹«å¿™æˆç²‰çš„èœœèœ‚éƒ½ä¸€èµ·æ®ºæ­»ï¼Œå°è‡´è¾²ç”°ç”Ÿæ…‹å´©æ½°ã€‚" 
                },
                { 
                    text: "è£½ä½œã€Œè¾£æ¤’å¤§è’œæ°´ã€å™´ç‘ï¼Œä¸¦å‹•æ‰‹æŠ“èŸ²ã€‚", 
                    type: "good", 
                    feedback: "å¤ªæ£’äº†ï¼é›–ç„¶æ‰‹å¾ˆé…¸ï¼Œä½†é€™æ˜¯å¤©ç„¶ç„¡æ¯’çš„é©…èŸ²æ³•ï¼",
                    knowledge: "ã€ç”Ÿç‰©/ç‰©ç†é˜²æ²»ã€‘\nè‡ªç„¶è¾²æ³•åˆ©ç”¨å®³èŸ²è¨å­çš„æ°£å‘³ï¼ˆå¦‚è¾£æ¤’ç´ ã€è’œç´ ï¼‰ä¾†é©…è¶•ç‰ å€‘ï¼Œé€™ç¨±ç‚ºã€Œå¿Œé¿åŠ‘ã€ã€‚é›–ç„¶æ•ˆæœä¸å¦‚åŒ–å­¸è—¥åŠ‘æŒä¹…ï¼Œä½†å°ç’°å¢ƒå®Œå…¨ç„¡å®³ã€‚æ‰‹å‹•æŠ“èŸ²å‰‡æ˜¯ç‰©ç†é˜²æ²»çš„ä¸€ç¨®ï¼Œé›–ç„¶è²»å·¥ï¼Œä½†èƒ½ç²¾æº–ç§»é™¤å®³èŸ²è€Œä¸å‚·å®³å…¶ä»–ç”Ÿç‰©ã€‚"
                }
            ]
        },
        {
            title: "è‚šå­é¤“çš„è”¬èœ", 
            images: ["4.png"],
            desc: "è”¬èœæœ€è¿‘çœ‹èµ·ä¾†å‚é ­å–ªæ°£ï¼Œè‘‰å­é»ƒé»ƒçš„ã€‚éš”å£é„°å±…å»ºè­°æ’’è—è‰²åŒ–å­¸è‚¥ã€‚",
            grandpa: "é˜¿å…¬ï¼šã€ŒåŒ–å­¸è‚¥é›–ç„¶é•·å¾—å¿«ï¼Œä½†èœæœƒè®Šå¾—è™›èƒ–ä¸å¥åº·ã€‚ã€",
            options: [
                { 
                    text: "å»å †è‚¥ç®±æŒ–å‡ºå»šé¤˜å †è‚¥ä¾†æ–½è‚¥ã€‚", 
                    type: "good", 
                    feedback: "æ­£ç¢ºï¼æœ‰æ©Ÿè³ªè®“åœŸå£¤å¾®ç”Ÿç‰©è®Šå¤šï¼Œèœèœåƒå¾—å¥åº·åˆå£¯ç¢©ï¼",
                    knowledge: "ã€æœ‰æ©Ÿè‚¥ vs åŒ–å­¸è‚¥ã€‘\nå †è‚¥å«æœ‰è±å¯Œçš„æœ‰æ©Ÿè³ªï¼Œèƒ½æ”¹å–„åœŸå£¤çµæ§‹ï¼Œä¸¦æä¾›å¾®ç”Ÿç‰©é£Ÿç‰©ã€‚å¾®ç”Ÿç‰©åœ¨åˆ†è§£å †è‚¥æ™‚ï¼Œæœƒç·©æ…¢é‡‹æ”¾æ¤ç‰©æ‰€éœ€çš„æ°®ã€ç£·ã€é‰€ï¼Œé€™å«ã€Œç·©é‡‹è‚¥ã€ã€‚åŒ–å­¸è‚¥æ–™é›–ç„¶é€Ÿæ•ˆï¼Œä½†é•·æœŸä½¿ç”¨æœƒå°è‡´åœŸå£¤é…¸åŒ–ã€æ¿çµï¼ˆè®Šç¡¬ï¼‰ï¼Œä¸”å®¹æ˜“é€ æˆåœ°ä¸‹æ°´æ±¡æŸ“ã€‚"
                },
                { 
                    text: "å·æ‡¶æ’’åŒ–å­¸è‚¥æ–™ï¼Œåæ­£é˜¿å…¬æ²’çœ‹åˆ°ã€‚", 
                    type: "bad", 
                    feedback: "å¤±æ•—...èœé›–ç„¶é•·å¤§äº†ï¼Œä½†è®Šå¾—å¾ˆå®¹æ˜“ç”Ÿç—…ï¼ŒåœŸå£¤ä¹Ÿè®Šé…¸äº†ã€‚",
                    knowledge: "ã€æ¤ç‰©çš„è™›èƒ–ã€‘\nå¤§é‡æ–½ç”¨åŒ–å­¸æ°®è‚¥ï¼Œæœƒè®“æ¤ç‰©ç´°èƒå¿«é€Ÿå¸æ°´è†¨è„¹ï¼Œé•·å¾—åˆå¿«åˆå¤§ï¼Œçœ‹èµ·ä¾†å¾ˆæ¼‚äº®ï¼Œä½†ç´°èƒå£æœƒè®Šè–„ã€‚é€™å°±åƒäººåƒåƒåœ¾é£Ÿç‰©è™›èƒ–ä¸€æ¨£ï¼Œæ¤ç‰©çš„æŠµæŠ—åŠ›æœƒè®Šå·®ï¼Œæ›´å®¹æ˜“æ‹›å¼•å®³èŸ²å®å’¬ï¼Œä¹Ÿæ›´å®¹æ˜“å¾—åˆ°ç—…å®³ã€‚"
                }
            ]
        },
        {
            title: "çƒˆæ—¥ä¸‹çš„è€ƒé©—", 
            images: ["5.png"],
            desc: "ä¸­åˆ 12 é»ï¼Œå¤ªé™½è¶…å¤§ã€‚ä½ çœ‹é«˜éº—èœå¥½åƒå¿«æ¸´æ­»äº†ï¼Œæƒ³æ‹¿æ°´ç®¡ç›´æ¥æ²–ã€‚",
            grandpa: "é˜¿å…¬ï¼šã€Œä¿®ä½†å¹¾å‹’ï¼ç¾åœ¨æ¾†æ°´æ˜¯åœ¨ç…®èœæ¹¯å—ï¼Ÿã€",
            options: [
                { 
                    text: "å¿è€ä¸€ä¸‹ï¼Œç­‰åˆ°å‚æ™šå¤ªé™½ä¸‹å±±å†æ¾†æ°´ã€‚", 
                    type: "good", 
                    feedback: "å°ˆæ¥­ï¼ä¸­åˆæ¾†æ°´æœƒç”¢ç”Ÿé«˜æº«æ°´æ°£å‚·åˆ°æ ¹ï¼Œå‚æ™šæ¾†æ‰å°ã€‚",
                    knowledge: "ã€æ¤ç‰©çš„è’¸æ•£ä½œç”¨ã€‘\næ­£ä¸­åˆæ°£æº«é«˜ï¼ŒåœŸå£¤ä¹Ÿè¢«æ›¬å¾—å¾ˆç†±ã€‚æ­¤æ™‚è‹¥æ¾†å†·æ°´ï¼Œæ°´æ¥è§¸åˆ°æ»¾ç‡™çš„åœŸæœƒç¬é–“è®Šæˆç†±æ°´æ°£ï¼Œæ‚¶ä½æ¤ç‰©æ ¹ç³»ï¼Œé€ æˆã€Œæ‚¶æ ¹ã€ç¾è±¡ï¼Œå°è‡´æ ¹éƒ¨è…çˆ›ã€‚æœ€ä½³æ¾†æ°´æ™‚é–“æ˜¯æ¸…æ™¨æˆ–å‚æ™šï¼Œæ­¤æ™‚åœŸæº«è¼ƒä½ï¼Œæ°´åˆ†ä¹Ÿèƒ½æœ‰æ•ˆæ»²é€ã€‚"
                },
                { 
                    text: "ä¸ç®¡äº†ï¼Œç«‹åˆ»æ¾†å¤§é‡å†·æ°´é™æº«ï¼", 
                    type: "bad", 
                    feedback: "ç³Ÿç³•ï¼é«˜æº«æ™‚çªç„¶æ¾†å†·æ°´ï¼Œæ ¹éƒ¨å—å‚·ï¼ˆæ‚¶ç†±æ•ˆæ‡‰ï¼‰ï¼Œèœèœä¼‘å…‹äº†ï¼",
                    knowledge: "ã€ç”Ÿç†æ€§ä¹¾æ—±ã€‘\né›–ç„¶æ¾†äº†æ°´ï¼Œä½†å› ç‚ºåœŸæº«éé«˜å°è‡´æ ¹ç³»å—å‚·ï¼Œåè€Œç„¡æ³•å¸æ°´ï¼Œé€™ç¨±ç‚ºç”Ÿç†æ€§ä¹¾æ—±ã€‚æ­¤å¤–ï¼Œè‘‰ç‰‡ä¸Šçš„å°æ°´ç åœ¨å¼·çƒˆé™½å…‰ä¸‹æœƒå½¢æˆã€Œé€é¡æ•ˆæ‡‰ã€ï¼Œåƒæ”¾å¤§é¡ä¸€æ¨£èšå…‰ï¼Œç¼å‚·è‘‰ç‰‡ï¼Œå½¢æˆæ›¬æ–‘ã€‚"
                }
            ]
        },
        {
            title: "å°‹æ‰¾å¥½å¤¥ä¼´", 
            images: ["6.png"],
            desc: "é˜¿å…¬æƒ³åœ¨èœæ—é‚Šç¨®é»åˆ¥çš„æ¤ç‰©ä¾†å¹«å¿™é©…èŸ²ï¼ˆå¿Œé¿ä½œç‰©ï¼‰ã€‚",
            grandpa: "é˜¿å…¬ï¼šã€Œé¸ä¸€ç¨®å‘³é“é‡çš„æ¤ç‰©ï¼ŒèŸ²èŸ²å°±ä¸æ•¢é è¿‘äº†ã€‚ã€",
            options: [
                { 
                    text: "ç¨®ä¸€äº›ã€Œè–„è·ã€æˆ–ã€Œè”¥è’œã€ã€‚", 
                    type: "good", 
                    feedback: "æ­£ç¢ºï¼é€™äº›æ¤ç‰©æ°£å‘³å¼·çƒˆï¼Œæ˜¯å¤©ç„¶çš„é˜²èŸ²å®ˆè¡›ï¼",
                    knowledge: "ã€é–“ä½œèˆ‡å…±æ¦®ä½œç‰©ã€‘\nåœ¨ä¸»ä½œç‰©æ—ç¨®æ¤å¦ä¸€ç¨®ä½œç‰©ï¼Œç¨±ç‚ºã€Œé–“ä½œã€ã€‚è”¥ã€è’œã€éŸ­èœã€è–„è·ã€è¬å£½èŠç­‰æ¤ç‰©ï¼Œæœƒæ•£ç™¼å¼·çƒˆçš„æ®ç™¼æ€§æ°£å‘³ï¼Œèƒ½å¹²æ“¾å®³èŸ²çš„å—…è¦ºï¼Œä½¿ç‰ å€‘æ‰¾ä¸åˆ°å®¿ä¸»æ¤ç‰©ã€‚é€™ç¨®äº’ç›¸å¹«åŠ©çš„æ¤ç‰©çµ„åˆï¼Œç¨±ç‚ºã€Œå…±æ¦®ä½œç‰©ã€(Companion Plants)ã€‚"
                },
                { 
                    text: "å†ç¨®æ›´å¤šé«˜éº—èœï¼ŒæŠŠå®ƒæ“ å¾—æ»¿æ»¿çš„ã€‚", 
                    type: "bad", 
                    feedback: "å¤ªæ“ çš„è©±é€šé¢¨ä¸è‰¯ï¼Œåè€Œæ›´å®¹æ˜“å¾—åˆ°é»´èŒç—…å®³å–”ï¼",
                    knowledge: "ã€å–®ä¸€æ ½åŸ¹çš„é¢¨éšªã€‘\nå¦‚æœæ•´ç‰‡ç”°éƒ½ç¨®åŒä¸€ç¨®ä½œç‰©ï¼ˆå–®ä¸€æ ½åŸ¹ï¼‰ï¼Œä¸€æ—¦ç™¼ç”Ÿç—…èŸ²å®³ï¼Œå°±æœƒåƒå‚³æŸ“ç—…ä¸€æ¨£è¿…é€Ÿè”“å»¶å…¨ç”°ï¼Œç”šè‡³å…¨è»è¦†æ²’ã€‚æ­¤å¤–ï¼Œç¨®å¤ªå¯†æœƒå°è‡´é€šé¢¨ä¸è‰¯ã€æ¿•åº¦éé«˜ï¼Œå®¹æ˜“æ»‹ç”Ÿé»´èŒï¼ˆå¦‚éœ²èŒç—…ã€ç™½ç²‰ç—…ï¼‰ã€‚ä¿æŒé©ç•¶æ ªè·æ˜¯å¥åº·çš„é—œéµã€‚"
                }
            ]
        }
    ];

    let currentQIndex = 0;
    let playerName = "";

    function startGame() {
        const nameInput = document.getElementById('username');
        if (!nameInput.value.trim()) { alert("è«‹å…ˆå¯«ä¸‹åå­—å–”ï¼"); return; }
        playerName = nameInput.value;
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        const q = storyQuestions[currentQIndex];
        document.getElementById('day-counter').innerText = `Day ${currentQIndex + 1}`;
        document.getElementById('progress').style.width = ((currentQIndex) / storyQuestions.length * 100) + "%";
        document.getElementById('q-title').innerText = q.title;
        document.getElementById('q-desc').innerHTML = q.desc;

        // --- åœ–ç‰‡è™•ç†é‚è¼¯ ---
        const imgArea = document.getElementById('image-area');
        imgArea.innerHTML = ""; // æ¸…ç©ºèˆŠåœ–ç‰‡

        if (q.images && q.images.length > 0) {
            q.images.forEach(filename => {
                const img = document.createElement('img');
                img.src = filename;
                img.className = 'real-photo';
                if (q.images.length >= 2) {
                    img.classList.add('double-img');
                } else {
                    img.classList.add('single-img');
                }
                imgArea.appendChild(img);
            });
        }

        const optsDiv = document.getElementById('options-area');
        optsDiv.innerHTML = ""; 
        const shuffledOptions = [...q.options].sort(() => 0.5 - Math.random()); 

        shuffledOptions.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            btn.onclick = () => checkAnswer(opt, q.grandpa);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(opt, grandpaText) {
        const container = document.getElementById('main-container');
        const feedbackDiv = document.createElement('div');
        feedbackDiv.className = 'feedback-modal fade-in';
        
        let titleColor = opt.type === 'good' ? '#558B2F' : '#D32F2F';
        let titleText = opt.type === 'good' ? 'â­• é¸æ“‡æ­£ç¢ºï¼' : 'âŒ é˜¿å…¬å¥½å‚·å¿ƒ...';

        let contentHTML = `
            <div class="feedback-content">
                <div style="font-size:60px">${opt.type === 'good' ? 'ğŸ‰' : 'ğŸ’¦'}</div>
                <h2 style="color:${titleColor}; margin:10px 0; border:none;">${titleText}</h2>
                <div class="story-box">
                    ${opt.type === 'good' ? opt.feedback : grandpaText + '<br><br><span style="color:#666; font-size:14px;">(æç¤ºï¼š' + opt.feedback + ')</span>'}
                </div>
                
                <details>
                    <summary>ğŸ’¡ é»æˆ‘çœ‹è©³ç´°çŸ¥è­˜</summary>
                    <div class="knowledge-content">
                        ${opt.knowledge}
                    </div>
                </details>

                <button class="btn" onclick="${opt.type === 'good' ? 'nextQuestion()' : 'closeFeedback()'}" style="${opt.type === 'good' ? '' : 'background:#9E9E9E'}">
                    ${opt.type === 'good' ? 'ç¹¼çºŒä¸‹ä¸€å¤© âœ' : 'é‡æ–°é¸æ“‡ â†º'}
                </button>
            </div>
        `;

        feedbackDiv.innerHTML = contentHTML;
        container.appendChild(feedbackDiv);
    }

    function closeFeedback() {
        const modals = document.querySelectorAll('.feedback-modal');
        modals.forEach(m => m.remove());
    }

    function nextQuestion() {
        closeFeedback();
        currentQIndex++;
        if (currentQIndex < storyQuestions.length) {
            renderQuestion();
        } else {
            showGameResult();
        }
    }

    function showGameResult() {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('result-name').innerText = playerName;
    }

    /* ================= æƒæå™¨éƒ¨åˆ†è®Šæ•¸èˆ‡é‚è¼¯ ================= */

    function goToScanner() {
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('scanner-input').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('preview-img');
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                document.getElementById('cam-placeholder').style.display = 'none';
                document.getElementById('final-photo').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function updateVal(id, val) {
        document.getElementById(id).innerText = val;
    }

    function generateDiary() {
        const crop = document.getElementById('cropName').value || "ç¥ç§˜ä½œç‰©";
        const growth = parseInt(document.getElementById('growth').value);
        const health = parseInt(document.getElementById('health').value);
        
        const imgSrc = document.getElementById('preview-img').src;
        if (!imgSrc || imgSrc === window.location.href) {
            document.getElementById('final-photo').style.display = 'none';
            document.getElementById('no-photo-text').style.display = 'block';
        } else {
            document.getElementById('final-photo').style.display = 'flex';
            document.getElementById('no-photo-text').style.display = 'none';
        }

        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        let threats = [];
        checkboxes.forEach((checkbox) => {
            threats.push(checkbox.value);
        });

        let score = (growth + health) / 2;
        score -= (threats.length * 10);
        let rank = "åŠ æ²¹";
        if (score >= 90) rank = "ç‰¹å„ª";
        else if (score >= 80) rank = "å„ªç­‰";
        else if (score >= 70) rank = "è‰¯å¥½";
        else if (score >= 60) rank = "å°šå¯";

        let report = `é€™æ ª <b>${crop}</b> è¨˜éŒ„å®Œæˆï¼<br>`;
        if (threats.length > 0) {
            report += `<span style="color:#D32F2F">é˜¿å…¬ï¼šã€Œå“å”·ï¼è¦æ³¨æ„ ${threats.join('ã€')} çš„å•é¡Œå–”ï¼è¶•å¿«è™•ç†ä¸€ä¸‹ã€‚ã€</span>`;
        } else {
            report += `<span style="color:#558B2F">é˜¿å…¬ï¼šã€Œé¡§å¾—å¾ˆå¥½å–”ï¼çœ‹èµ·ä¾†é ­å¥½å£¯å£¯ï¼Œç¹¼çºŒä¿æŒï¼ã€</span>`;
        }

        document.getElementById('diary-crop-name').innerText = crop;
        const today = new Date();
        document.getElementById('today-date').innerText = `${today.getFullYear()}/${today.getMonth()+1}/${today.getDate()}`;
        
        document.getElementById('txt-growth').innerText = growth + "%";
        document.getElementById('bar-growth').style.width = growth + "%";
        
        document.getElementById('txt-health').innerText = health + "%";
        document.getElementById('bar-health').style.width = health + "%";
        
        document.getElementById('diary-report').innerHTML = report;
        document.getElementById('diary-rank').innerText = rank;

        document.getElementById('scanner-input').classList.add('hidden');
        document.getElementById('diary-result').classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    function resetScanner() {
        document.getElementById('cropName').value = "";
        document.getElementById('growth').value = 50; updateVal('growthVal', 50);
        document.getElementById('health').value = 50; updateVal('healthVal', 50);
        document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
        
        document.getElementById('preview-img').style.display = 'none';
        document.getElementById('preview-img').src = "";
        document.getElementById('cam-placeholder').style.display = 'block';
        document.getElementById('cameraInput').value = ""; 

        document.getElementById('diary-result').classList.add('hidden');
        document.getElementById('scanner-input').classList.remove('hidden');
        window.scrollTo(0, 0);
    }
</script>

</body>
</html>